# \B24LeadSender\LeadSender

## Описание

Класс для отправки лидов в Битрикс24. При создании лида приходит соответствующее уведомление ответственному сотруднику. Класс может отправлять следующие данные:

- Заголовок лида
- Имя контакта
- Телефон(ы)
- Е-мейл(ы)
- Комментарий к лиду

Перед использованием необходимо создать входящий вебхук в вашем Б24. Как это сделать &ndash; расписал в статье: [https://alfavitka.ru/sozdaem-lid-bitrix24-cherez-api/](https://alfavitka.ru/sozdaem-lid-bitrix24-cherez-api/ "https://alfavitka.ru/sozdaem-lid-bitrix24-cherez-api/")

Данные отправляются с помощью **curl**. Так что убедитесь, что это расширение установлено и активировано. Пример использования см. в файле **demo.php**

## Что еще я когда-нибудь сделаю
- Возможность отправки пользовательских свойств
- Возможность отправки UTM-меток
- Возможность отключать уведомление, которое приходит ответственному сотруднику при создании лида
- Возможность указывать тип телефонного номера (рабочий, домашний, мобильный и т.д.)
- Возможность указывать тип е-мейла (рабочий, домашний и т.д.)
- Возможно что-то еще, что я забыл записать в этот список :)

Я мог бы сделать всё это сразу же, но было бы не интересно :D


## Описание методов

### public function __construct($url, $webHook, $userId, $adminId)
**$url** – адрес вашего Б24 (без слэша в конце), например: **https://primer.bitrix24.ru**
**$webHook** – вебхук, который будет принимать лиды, например: **6m4x6dm6a5a0ng3p**
**$userId** – айди пользователя, который будет ответственным за лид
**$adminId** – айди пользователя-администратора. Честно говоря я не особо пытался разобраться, можно ли как-то обойтись без использования айди именно администратора. Возможно, достаточно передать айди пользователя с полными правами к CRM, но я не стал тратить время на эксперименты. Короче говоря: с айди администратора всё точно работает.

### public function SetName($name)
**$name** – текст, который попадет в поле "Имя" в карточке лида.

### public function SetTitle($title)
**$title** – текст, который будет указан как заголовок лида. Если не вызывать этот метод, то заголовок будет задан исходя из имени, переданого в SetName.

### public function AddPhone($tel)
**$tel** – текст, который попадет в поле "Телефон" в карточке лида. Если нужно добавить несколько разных номеров - вызываем этот метод несколько раз. В CRM все добавленные номера телефонов будут помечены как "Рабочие".

### public function AddEmail($email)
**$email** – текст, который попадет в поле "Е-мейл" в карточке лида. Если нужно добавить несколько разных емейлов - вызываем этот метод несколько раз. В CRM все добавленные емейлов будут помечены как "Рабочие".

### public function SetComments($msg)
**$msg** – текст, который попадет в поле "Комментарий" в карточке лида.

### public function Send()
Отправляет все подготовленные данные в Б24. В случае успешной отправки возвращает **true**. Иначе - вернет **false** и сохранит текст ошибки в переменную внутри объекта.

### public function GetError()
Возвращает текст ошибки, если метод Send() не сумел отправить лид в Б24.
